---
layout: post
title: 浏览器与IME
category: program
---

最近在改公司的 mention 组件，遇到了两个很奇妙的坑。

### 浏览器对IME输入触发事件的处理

在IME输入的时候，根据w3c标准，每一次按键都应该触发 keyCode: 229 的键盘事件。

chrome 和 safari 会在按键的时候触发 keydown/keyup - 229。

edge 会同时触发 keydown - 229 和普通的键盘事件 keydown/keyup(keyCode是原始值)

然而 Firefox 在输入的时候不会触发任何事件，要直到选字结束完全上屏的时候才会触发 keydown(windows下连这个都没有)/keyup (keyCode是选字时按键的值)

### IME输入时占位字符

IME在输入的时候，大概是为了让用户对输入的位置有预期，所以会用一些字符占位。

有一部分输入法是直接上屏，也就是用输入的拼音、笔画或者其他的东西占位。

另一部分输入法会用空字符占好位置，然后在选好词之后再替换到占位符的位置去。

不同的输入法选择了不同的占位符，大部分占位符可以被正则表达式的 `\s` 过滤掉，但还是有几个特殊的占位符对应的 unicode 如下：

- rime: 12288(空字符)
- sougou: 160(全角空格)

然而！在有的情况下，因为字符集的原因，12288会被截断成 1228 和 8！

显示出来的样子就是`ӌ`(因为8是空字符)




